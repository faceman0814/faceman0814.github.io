{"title":"Docker实现Linux科学上网","uid":"db862bea918e56d5ebf1541d0aa7193d","slug":"Linux科学上网","date":"2024-11-30T16:33:41.616Z","updated":"2024-12-01T01:45:11.961Z","comments":true,"path":"api/articles/Linux科学上网.json","keywords":null,"cover":"https://github.com/faceman0814/picx-images-hosting/raw/master/Qexo/24/11/image_3e7b0590d52851dcc8ca00f618db22f7.png","content":"<p>没想到我还能在Clash这里吃亏，事情是这样的，以前只玩过gitlab的CICD，官方的要钱，自己部署的话服务器配置有要求，而且我的项目基本都开源，所以今天准备研究下GitHub的CICD——Github Actions。经过上一篇文章，我准备了一个叫webtest的镜像，然后在我99一年的阿里云服务器上准备拉下来做实验，发现，拉不下来！报错如下：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Error response from daemon: Get “https://registry-1.docker.io/v2/”: context deadline exceeded</span><br></pre></td></tr></table></figure>\n\n<p>网上找了很多方法无非几种：</p>\n<ul>\n<li>改DNS</li>\n<li>配置其他镜像源</li>\n<li>上代理</li>\n</ul>\n<p>我这里因为是上传到docker的官方镜像仓库，所以改DNS和镜像源没有用，所以就剩一招了，上代理。</p>\n<p>于是，我就开始往Ubuntu上折腾Clash，因为我之前弄过Clash，但我不记得我为啥关了，用的是Ubuntu系统下systemctl start clash的启动方式，具体的可以参考我的文章：<a href=\"https://www.notion.so/Clash-for-Ubuntu-c245bda433d24d07ad1d5e5b84734fdb\">Clash for Ubuntu</a>，问题又来了，我发现官方提供的链接面板<a href=\"https://clash.razord.top/#/proxies\">Clash (razord.top)</a>死活连不上，要么报跨域，要么就是Net Error啥的，我查了下相关issue，clash的设计问题，最好是设置密码，于是我又去config.yml设置密码，但发现偶尔能连上，大部分时间连不上，不稳定。于是我又慢慢搜索解决方案，发现可以用yacd来解决，这个也有提供官方的链接<a href=\"http://yacd.haishan.me/\">yacd (haishan.me)</a>供你使用，但我试了下偶尔也不稳定，于是我自己部署，一下就搞定了！但这里有个要注意的地方就是如果你加了证书，那么两个都要加不然也识别不到。</p>\n<h2 id=\"Docker教程\"><a href=\"#Docker教程\" class=\"headerlink\" title=\"Docker教程\"></a>Docker教程</h2><p>这里我提供一个DockerCompose来部署，用systemctl部署麻烦得很，还要想办法找源文件,而且有更改的话很麻烦，docker方便。</p>\n<p>首先，去代理软件复制节点订阅地址,准备一个config.yml配置文件，放到&#x2F;root&#x2F;.config&#x2F;clash路径下，参考<a href=\"https://www.notion.so/Clash-for-Ubuntu-c245bda433d24d07ad1d5e5b84734fdb\">Clash for Ubuntu (notion.so)</a>获取这里我不重复说明。</p>\n<p>然后设置密码<br><img src=\"https://github.com/faceman0814/picx-images-hosting/raw/master/Qexo/24/12/image_be2a09eba940682146758dae26459a36.png\"></p>\n<p>再然后创建clash&#x2F;docker-compose.yml文件</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">version: &#x27;3.9&#x27;</span><br><span class=\"line\">services:</span><br><span class=\"line\">  yacd:</span><br><span class=\"line\">    image: ghcr.io/haishanh/yacd:master</span><br><span class=\"line\">    container_name: yacd</span><br><span class=\"line\">    ports:</span><br><span class=\"line\">      - &quot;1234:80&quot;</span><br><span class=\"line\">    restart: unless-stopped</span><br><span class=\"line\"></span><br><span class=\"line\">  clash:</span><br><span class=\"line\">    image: dreamacro/clash</span><br><span class=\"line\">    container_name: clash</span><br><span class=\"line\">    volumes:</span><br><span class=\"line\">      - ./.config/clash:/root/.config/clash</span><br><span class=\"line\">      # - ./ui:/ui # dashboard volume (uncomment if needed)</span><br><span class=\"line\">    ports:</span><br><span class=\"line\">      - &quot;7890:7890&quot;</span><br><span class=\"line\">      - &quot;7891:7891&quot;</span><br><span class=\"line\">      # - &quot;8080:8080&quot; # external controller (Restful API, uncomment if needed)</span><br><span class=\"line\">    # TUN capabilities (uncomment if needed)</span><br><span class=\"line\">    # cap_add:</span><br><span class=\"line\">    #   - NET_ADMIN</span><br><span class=\"line\">    # devices:</span><br><span class=\"line\">    #   - /dev/net/tun</span><br><span class=\"line\">    restart: unless-stopped</span><br><span class=\"line\">    network_mode: &quot;host&quot;  # use &quot;bridge&quot; mode in non-Linux environments if required</span><br></pre></td></tr></table></figure>\n\n<p>再再然后执行<code>docker compose up -d</code></p>\n<p>如果是云服务器记得开放1234和9090端口</p>\n<p><img src=\"https://github.com/faceman0814/picx-images-hosting/raw/master/Qexo/24/12/image_f70375848c68c335f16e54ed33ce2288.png\"></p>\n<p>PS：有时候有代理也拉不到docker官方的镜像，网络问题，垃圾的很，所以建议大家自己的镜像可以放到自己的私有仓库里。</p>\n","feature":false,"text":"没想到我还能在Clash这里吃亏，事情是这样的，以前只玩过gitlab的CICD，官方的要钱，自己部署的话服务器配置有要求，而且我的项目基本都开源，所以今天准备...","permalink":"/post/Linux科学上网","photos":[],"count_time":{"symbolsCount":"1.9k","symbolsTime":"2 mins."},"categories":[{"name":"DevOps","slug":"DevOps","count":11,"path":"api/categories/DevOps.json"}],"tags":[{"name":"Docker","slug":"Docker","count":6,"path":"api/tags/Docker.json"},{"name":"Clash","slug":"Clash","count":1,"path":"api/tags/Clash.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#Docker%E6%95%99%E7%A8%8B\"><span class=\"toc-text\">Docker教程</span></a></li></ol>","author":{"name":"FaceMan","slug":"blog-author","avatar":"https://github.com/faceman0814/picx-images-hosting/raw/master/20241114/image.2vermeukr5.webp","link":"/","description":"从0开始，直到1。","socials":{"github":"https://github.com/faceman0814","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/manmanzainuli","juejin":"","customs":{"bokeyuan":{"icon":"/svg/bokeyuan.svg","link":"https://www.cnblogs.com/FaceMan"}}}},"mapped":true,"hidden":false,"prev_post":{"title":"我在人间凑数的第8865天","uid":"2f6f4322594661f0414df8fc201523ed","slug":"2024.12.24日常小记","date":"2024-12-24T01:56:11.053Z","updated":"2024-12-24T01:56:20.909Z","comments":true,"path":"api/articles/2024.12.24日常小记.json","keywords":null,"cover":"https://github.com/faceman0814/picx-images-hosting/raw/master/Qexo/24/12/image_486ded1f771e374c316e9da3db6c0b2e.png","text":"随便叭叭有时候想成为一个有思想深度的人，但奈何读书太少没啥文化，看书于我而言跟催眠无差别，于是我放弃🙄 。 最近喜欢一个泰国女演员Orm，她身上蓬勃的生命力和明...","permalink":"/post/2024.12.24日常小记","photos":[],"count_time":{"symbolsCount":304,"symbolsTime":"1 mins."},"categories":[{"name":"日常","slug":"日常","count":2,"path":"api/categories/日常.json"}],"tags":[{"name":"杂谈","slug":"杂谈","count":1,"path":"api/tags/杂谈.json"}],"author":{"name":"FaceMan","slug":"blog-author","avatar":"https://github.com/faceman0814/picx-images-hosting/raw/master/20241114/image.2vermeukr5.webp","link":"/","description":"从0开始，直到1。","socials":{"github":"https://github.com/faceman0814","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/manmanzainuli","juejin":"","customs":{"bokeyuan":{"icon":"/svg/bokeyuan.svg","link":"https://www.cnblogs.com/FaceMan"}}}},"feature":false},"next_post":{"title":" Docker拉取netsdk镜像","uid":"effef2644cf5d4dbdf4ef3a751e9c7bc","slug":"docker拉取netsdk镜像","date":"2024-11-29T00:00:00.000Z","updated":"2024-12-24T01:56:35.265Z","comments":true,"path":"api/articles/docker拉取netsdk镜像.json","keywords":null,"cover":"https://github.com/faceman0814/picx-images-hosting/raw/master/Qexo/24/11/image_519a183df02cb543cc73a046fcdd76e9.png","text":"在写DockerFile文件时，发现直接拉取mcr.microsoft.com/dotnet/sdk:9.0报错： 123PS D:\\Study\\Demos\\D...","permalink":"/post/docker拉取netsdk镜像","photos":[],"count_time":{"symbolsCount":470,"symbolsTime":"1 mins."},"categories":[{"name":"DevOps","slug":"DevOps","count":11,"path":"api/categories/DevOps.json"}],"tags":[{"name":"Docker","slug":"Docker","count":6,"path":"api/tags/Docker.json"},{"name":".Net SDK","slug":"Net-SDK","count":1,"path":"api/tags/Net-SDK.json"}],"author":{"name":"FaceMan","slug":"blog-author","avatar":"https://github.com/faceman0814/picx-images-hosting/raw/master/20241114/image.2vermeukr5.webp","link":"/","description":"从0开始，直到1。","socials":{"github":"https://github.com/faceman0814","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/manmanzainuli","juejin":"","customs":{"bokeyuan":{"icon":"/svg/bokeyuan.svg","link":"https://www.cnblogs.com/FaceMan"}}}},"feature":false}}
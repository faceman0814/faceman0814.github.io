{"title":"Ubuntu在容器中通过bak文件还原数据库","uid":"09bfaf6dad899e5435cf142c3bc6c1cb","slug":"在容器中通过bak文件还原数据库","date":"2024-11-19T00:00:00.000Z","updated":"2024-12-24T01:56:35.266Z","comments":true,"path":"api/articles/在容器中通过bak文件还原数据库.json","keywords":null,"cover":"https://github.com/faceman0814/picx-images-hosting/raw/master/20241114/code.m3gmcd1o.webp","content":"<h1 id=\"在容器中通过bak文件还原数据库\"><a href=\"#在容器中通过bak文件还原数据库\" class=\"headerlink\" title=\"在容器中通过bak文件还原数据库\"></a>在容器中通过bak文件还原数据库</h1><p>1、测试环境需要迁移到另一台虚拟机上时</p>\n<ul>\n<li>可以使用nfs的方式获取备份文件，右上角搜索另一篇文章：NFS for CentOS</li>\n<li>使用scp命令从本机拷贝文件到目标服务器上，只需要提供目标服务器账号和密码。</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">scp /path filename root@目标服务器ip地址：/path</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://github.com/faceman0814/picx-images-hosting/raw/master/20241116/image.7w6uh4lvq7.webp\"></p>\n<p>2、要保证容器内部空间可以容纳bak文件大小的空间，使用df -h 查看，如果不够需要现在外面修改本机的容量配置，具体方法参考上文扩大虚拟硬盘容量，主要是扩大centos-root的容量。</p>\n<p><img src=\"https://github.com/faceman0814/picx-images-hosting/raw/master/20241116/image.58he6rtbsv.webp\"></p>\n<p>3、根据上述我们已经可以拿到文件了，现在我们需要将文件移动到docker镜像中</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker cp /mnt/nfs/gct_medPro_22_12_28_13_40.bak <span class=\"number\">1e057306</span>ae58:/</span><br></pre></td></tr></table></figure>\n\n<p>其中：</p>\n<ul>\n<li>&#x2F;mnt&#x2F;nfs&#x2F;gct_medPro_22_12_28_13_40.bak 是你在共享文件的所属位置</li>\n<li>1e057306ae58 是容器id 或则容器名字也可以</li>\n</ul>\n<p>进入容器内部，然后执行还原命令、</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/opt/mssql-tools/bin/sqlcmd \\</span><br><span class=\"line\">-S localhost -U sa -P &lt;your_password&gt; \\</span><br><span class=\"line\">-Q <span class=\"string\">&quot;RESTORE DATABASE &lt;new_database_name&gt; FROM DISK=&#x27;&lt;path-inside-container&gt;/&lt;backup-file-name&gt;.bak&#x27; WITH MOVE &#x27;&lt;logical_data_name&gt;&#x27; TO &#x27;&lt;new_data_file_path&gt;&#x27;, MOVE &#x27;&lt;logical_log_name&gt;&#x27; TO &#x27;&lt;new_log_file_path&gt;&#x27;, REPLACE, STATS=5&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p>其中 <code>&lt;container-name&gt;</code> 是容器的名称，<code>&lt;your_password&gt;</code> 是 SQL Server 的管理员密码，<code>&lt;new_database_name&gt;</code> 是你想要创建的新数据库的名称，<code>&lt;path-inside-container&gt;</code> 是之前复制备份文件的路径，<code>&lt;backup-file-name&gt;</code> 是备份文件的名称，<code>&lt;logical_data_name&gt;</code> 和 <code>&lt;logical_log_name&gt;</code> 是备份文件中的逻辑文件名，<code>&lt;new_data_file_path&gt;</code> 和 <code>&lt;new_log_file_path&gt;</code> 是你想要为新数据库指定的数据文件和日志文件的路径。</p>\n<p>例如：</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#我先查看还原文件位置</span><br><span class=\"line\">root@<span class=\"number\">1e057306</span>ae58:/<span class=\"meta\"># ls</span></span><br><span class=\"line\">bin  boot  dev  etc  gct_medPro_22_12_28_13_40.bak  home  lib  lib32  lib64  libx32  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var</span><br><span class=\"line\">然后执行</span><br><span class=\"line\">root@<span class=\"number\">1e057306</span>ae58:/# /opt/mssql-tools/bin/sqlcmd -S localhost -U SA -P <span class=\"string\">&#x27;bb123456??&#x27;</span> -Q <span class=\"string\">&quot;RESTORE DATABASE gct_medPro FROM DISK=&#x27;/gct_medPro_22_12_28_13_40.bak&#x27; WITH MOVE &#x27;gct_medPro&#x27; TO &#x27;/var/opt/mssql/data/gct_medPro.mdf&#x27;, MOVE &#x27;gct_medPro_log&#x27; TO &#x27;/var/opt/mssql/data/gct_medPro.ldf&#x27;&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p>看到这个你就赢了。</p>\n<p><img src=\"https://github.com/faceman0814/picx-images-hosting/raw/master/20241116/image.6pnj8iz244.webp\" alt=\"alt text\"></p>\n","text":"在容器中通过bak文件还原数据库1、测试环境需要迁移到另一台虚拟机上时 可以使用nfs的方式获取备份文件，右上角搜索另一篇文章：NFS for CentOS 使...","permalink":"/post/在容器中通过bak文件还原数据库","photos":[],"count_time":{"symbolsCount":"1.8k","symbolsTime":"2 mins."},"categories":[{"name":"DevOps","slug":"DevOps","count":11,"path":"api/categories/DevOps.json"}],"tags":[{"name":"Docker","slug":"Docker","count":6,"path":"api/tags/Docker.json"},{"name":"Linux","slug":"Linux","count":3,"path":"api/tags/Linux.json"},{"name":"Ubuntu","slug":"Ubuntu","count":1,"path":"api/tags/Ubuntu.json"},{"name":"数据库","slug":"数据库","count":1,"path":"api/tags/数据库.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%9C%A8%E5%AE%B9%E5%99%A8%E4%B8%AD%E9%80%9A%E8%BF%87bak%E6%96%87%E4%BB%B6%E8%BF%98%E5%8E%9F%E6%95%B0%E6%8D%AE%E5%BA%93\"><span class=\"toc-text\">在容器中通过bak文件还原数据库</span></a></li></ol>","author":{"name":"FaceMan","slug":"blog-author","avatar":"https://github.com/faceman0814/picx-images-hosting/raw/master/20241114/image.2vermeukr5.webp","link":"/","description":"从0开始，直到1。","socials":{"github":"https://github.com/faceman0814","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/manmanzainuli","juejin":"","customs":{"bokeyuan":{"icon":"/svg/bokeyuan.svg","link":"https://www.cnblogs.com/FaceMan"}}}},"mapped":true,"hidden":false,"prev_post":{"title":"c#实现对话记录转PDF、Word、MD文件","uid":"d153e7aca8864e461d50ee65cfb7c4b4","slug":"c#实现对话记录转PDF、Word、MD文件","date":"2024-11-19T00:00:00.000Z","updated":"2024-12-24T01:56:35.265Z","comments":true,"path":"api/articles/c#实现对话记录转PDF、Word、MD文件.json","keywords":null,"cover":"https://github.com/faceman0814/picx-images-hosting/raw/master/20241114/esmeralda.2krxt9cbnx.webp","text":"工作中有个场景是chatgpt聊天对话记录下载支持PDF、Word、MD格式，于是有了本篇文章。 实现思路对话中可能会用md格式的回答，且因为不能直接转成pdf...","permalink":"/post/c#实现对话记录转PDF、Word、MD文件","photos":[],"count_time":{"symbolsCount":"8.7k","symbolsTime":"8 mins."},"categories":[{"name":".Net","slug":"Net","count":4,"path":"api/categories/Net.json"}],"tags":[{"name":"c#","slug":"c","count":2,"path":"api/tags/c.json"},{"name":".Net","slug":"Net","count":2,"path":"api/tags/Net.json"}],"author":{"name":"FaceMan","slug":"blog-author","avatar":"https://github.com/faceman0814/picx-images-hosting/raw/master/20241114/image.2vermeukr5.webp","link":"/","description":"从0开始，直到1。","socials":{"github":"https://github.com/faceman0814","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/manmanzainuli","juejin":"","customs":{"bokeyuan":{"icon":"/svg/bokeyuan.svg","link":"https://www.cnblogs.com/FaceMan"}}}}},"next_post":{"title":"DockerSwarm环境搭建","uid":"b41db14a99677b936cf320d0d9be73f1","slug":"DockerSwarm环境搭建","date":"2024-11-18T16:00:00.000Z","updated":"2024-11-29T09:33:04.458Z","comments":true,"path":"api/articles/DockerSwarm环境搭建.json","keywords":null,"cover":"https://github.com/faceman0814/picx-images-hosting/raw/master/20241116/image.7p3mlpbv6a.webp","text":"Swarm环境搭建系统规划 环境准备创建服务器新建三台虚拟机 节点 IP 系统 配置 存储 服务 manager 192.168.2.xx CentOS7.6 ...","permalink":"/post/DockerSwarm环境搭建","photos":[],"count_time":{"symbolsCount":"2.7k","symbolsTime":"2 mins."},"categories":[{"name":"DevOps","slug":"DevOps","count":11,"path":"api/categories/DevOps.json"}],"tags":[{"name":"Docker","slug":"Docker","count":6,"path":"api/tags/Docker.json"}],"author":{"name":"FaceMan","slug":"blog-author","avatar":"https://github.com/faceman0814/picx-images-hosting/raw/master/20241114/image.2vermeukr5.webp","link":"/","description":"从0开始，直到1。","socials":{"github":"https://github.com/faceman0814","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/manmanzainuli","juejin":"","customs":{"bokeyuan":{"icon":"/svg/bokeyuan.svg","link":"https://www.cnblogs.com/FaceMan"}}}}}}